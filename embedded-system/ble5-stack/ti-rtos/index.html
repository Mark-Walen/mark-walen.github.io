<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>线程模块 | Blue Monster</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#1e2d51">
    <meta name="description" content="本文是对 ti rtos 官方文档的翻译">
    <meta name="author" content="Mark Walen">
    <meta name="keywords" content="蓝芒小栈,Blue Monster,嵌入式软件,STM32,C 语言,数据结构">
    <meta name="theme-color" content="#1e2d51">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.ec95ac3a.css" as="style"><link rel="preload" href="/assets/js/app.7099126a.js" as="script"><link rel="preload" href="/assets/js/2.0bcf0fe5.js" as="script"><link rel="preload" href="/assets/js/12.6771515a.js" as="script"><link rel="preload" href="/assets/js/3.94c01751.js" as="script"><link rel="prefetch" href="/assets/js/10.e91b63fd.js"><link rel="prefetch" href="/assets/js/11.a760ca5e.js"><link rel="prefetch" href="/assets/js/13.3487e202.js"><link rel="prefetch" href="/assets/js/14.2de6dedc.js"><link rel="prefetch" href="/assets/js/15.e86c1792.js"><link rel="prefetch" href="/assets/js/16.63d2bce2.js"><link rel="prefetch" href="/assets/js/17.ef560323.js"><link rel="prefetch" href="/assets/js/18.8d0f809c.js"><link rel="prefetch" href="/assets/js/19.6b8bc6e3.js"><link rel="prefetch" href="/assets/js/20.16926133.js"><link rel="prefetch" href="/assets/js/21.b44ed802.js"><link rel="prefetch" href="/assets/js/22.682adcb3.js"><link rel="prefetch" href="/assets/js/23.0ce98934.js"><link rel="prefetch" href="/assets/js/24.92c8f8ce.js"><link rel="prefetch" href="/assets/js/25.844a5f79.js"><link rel="prefetch" href="/assets/js/26.27a722db.js"><link rel="prefetch" href="/assets/js/27.2667b260.js"><link rel="prefetch" href="/assets/js/28.822608a4.js"><link rel="prefetch" href="/assets/js/4.07fc0971.js"><link rel="prefetch" href="/assets/js/5.1ed8e759.js"><link rel="prefetch" href="/assets/js/6.e86380d3.js"><link rel="prefetch" href="/assets/js/7.2a955bf9.js"><link rel="prefetch" href="/assets/js/8.2d140ac7.js"><link rel="prefetch" href="/assets/js/9.2e62f1e7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ec95ac3a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Blue Monster</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Programming" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Programming" class="mobile-dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/program/c/" class="nav-link">
  C 语言程序设计
</a></li><li class="dropdown-item"><!----> <a href="/program/data-structure/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Embedded System" class="dropdown-title"><span class="title">嵌入式系统</span> <span class="arrow down"></span></button> <button type="button" aria-label="Embedded System" class="mobile-dropdown-title"><span class="title">嵌入式系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          BLE5 Stack
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/embedded-system/ble5-stack/ti-rtos/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  TI-RTOS
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/embedded-system/ecp/" class="nav-link">
  电子通信协议
</a></li><li class="dropdown-item"><!----> <a href="/embedded-system/stm32/stm32-learning-process.html" class="nav-link">
  STM32 入门学习
</a></li></ul></div></div><div class="nav-item"><a href="/resources.html" class="nav-link">
  资源领取
</a></div><div class="nav-item"><a href="https://dev.ti.com/tirex/explore/node?node=AAliBv1MZ54NaV.m2AIT8w__krol.2c__LATEST" target="_blank" rel="noopener noreferrer" class="nav-link external">
  TI Resource Explorer
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Programming" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Programming" class="mobile-dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/program/c/" class="nav-link">
  C 语言程序设计
</a></li><li class="dropdown-item"><!----> <a href="/program/data-structure/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Embedded System" class="dropdown-title"><span class="title">嵌入式系统</span> <span class="arrow down"></span></button> <button type="button" aria-label="Embedded System" class="mobile-dropdown-title"><span class="title">嵌入式系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          BLE5 Stack
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/embedded-system/ble5-stack/ti-rtos/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  TI-RTOS
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/embedded-system/ecp/" class="nav-link">
  电子通信协议
</a></li><li class="dropdown-item"><!----> <a href="/embedded-system/stm32/stm32-learning-process.html" class="nav-link">
  STM32 入门学习
</a></li></ul></div></div><div class="nav-item"><a href="/resources.html" class="nav-link">
  资源领取
</a></div><div class="nav-item"><a href="https://dev.ti.com/tirex/explore/node?node=AAliBv1MZ54NaV.m2AIT8w__krol.2c__LATEST" target="_blank" rel="noopener noreferrer" class="nav-link external">
  TI Resource Explorer
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>TI-RTOS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/embedded-system/ble5-stack/ti-rtos/" aria-current="page" class="active sidebar-link">线程模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/embedded-system/ble5-stack/ti-rtos/#硬件中断-hwi" class="sidebar-link">硬件中断（Hwi）</a></li><li class="sidebar-sub-header"><a href="/embedded-system/ble5-stack/ti-rtos/#软件中断-swi" class="sidebar-link">软件中断（Swi）</a></li><li class="sidebar-sub-header"><a href="/embedded-system/ble5-stack/ti-rtos/#任务" class="sidebar-link">任务</a></li><li class="sidebar-sub-header"><a href="/embedded-system/ble5-stack/ti-rtos/#空闲任务-idle-task" class="sidebar-link">空闲任务（Idle Task）</a></li></ul></li><li><a href="/embedded-system/ble5-stack/ti-rtos/kernel_configuration.html" class="sidebar-link">内核配置</a></li><li><a href="/embedded-system/ble5-stack/ti-rtos/creating_vs_constructing.html" class="sidebar-link">创建 vs 构造</a></li><li><a href="/embedded-system/ble5-stack/ti-rtos/thread_synchronization.html" class="sidebar-link">线程同步</a></li><li><a href="/embedded-system/ble5-stack/ti-rtos/queues.html" class="sidebar-link">队列</a></li><li><a href="/embedded-system/ble5-stack/ti-rtos/tasks.html" class="sidebar-link">任务</a></li><li><a href="/embedded-system/ble5-stack/ti-rtos/clocks.html" class="sidebar-link">时钟</a></li><li><a href="/embedded-system/ble5-stack/ti-rtos/power_management.html" class="sidebar-link">功耗管理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>TI-RTOS 内核管理四种不同线程执行的上下文级别。线程模块按优先级降序显示如下：</p> <ul><li>硬件中断</li> <li>软件中断</li> <li>任务</li> <li>后台空闲函数的空闲任务</li></ul> <div id="figure-40" class="figure align-center"><span id="fig-tirtos-threads"></span> <img alt="TI-RTOS Execution Threads" src="https://dev.ti.com/tirex/explore/content/simplelink_cc2640r2_sdk_5_30_00_03/docs/ble5stack/ble_user_guide/html/_images/fig-tirtos-threads.jpg" class="medium-zoom-image"> <p class="caption"><span class="caption-number">Figure 40. </span> <span class="caption-text">图 40. TI-RTOS 执行线程</span></p></div> <h2 id="硬件中断-hwi"><a href="#硬件中断-hwi" class="header-anchor">#</a> 硬件中断（Hwi）</h2> <p>在 TI-RTOS 应用中，硬件中断线程（也被称为中断服务例程或 ISRs）拥有最高优先级。硬件中断线程用于执行有严格时间期限的任务。实时环境中有外部异步事件（中断）时，会触发硬件中断线程。通常情况下，硬件中断线程运行后，就会一直运行到完成，不会被其它线程抢占。如果启用了中断嵌套，硬件中断线程可以被其它更高优先级的硬件中断线程临时抢占。有关中断的嵌套、向量表和功能的具体信息，请参阅 <a href="https://www.ti.com/lit/ug/swcu117i/swcu117i.pdf?ts=1672803242700" target="_blank" rel="noopener noreferrer">CC13x0 CC26x0 SimpleLink 无线 MCU 技术参考手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>通常中断服务例程执行的时间较短，避免影响硬实时系统要求。此外，由于硬件中断线程必须运行到完成，因此不能从上下文中调用阻塞 API。</p> <p>需要中断的 TI-RTOS 驱动程序将为分配的外设初始化所需的中断。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>调试提供了使用 GPIO 和 Hwis 的示例。虽然 SDK 包含用于抽象硬件寄存器访问的外设驱动程序库，但建议使用线程安全的 TI-RTOS 驱动程序。</p></div> <p>CC2640R2 的 Hwi 模块支持零延迟中断。这些中断不需要通过 TI-RTOS Hwi 调度程序，因此他们比标准中断响应更快，但是这一特性禁止其<u>中断服务例程</u>（ISR， interrupt service routine）直接调用任何 TI-RTOS 内核 API。ISR 需要保留自己的上下文以防止它干扰内核的调度程序。</p> <h2 id="软件中断-swi"><a href="#软件中断-swi" class="header-anchor">#</a> 软件中断（Swi）</h2> <p>仿造硬件中断（Hwi），软件中断线程在 Hwi 线程和任务线程之间提供额外的优先级。Swi 与 Hwi（由硬件中断触发）不同的是：通过调用某些 Swi 模块 API 以编程方式触发。Swi 处理受时间限制的线程，这些时间限制阻止它们作为任务运行，但其最后期限不像硬件 ISR 那样严格。与 Hwis 一样，Swi 线程运行后，就会一直运行到完成，不会被其它线程抢占。Swi 允许 Hwi 将不太重要的处理推迟到较低优先级的线程，从而最大限度地减少 CPU 在中断服务例程中花费的时间，在中断服务例程中可以禁用其他 Hwi。Swis 只需要足够的空间来保存每个 Swi 中断优先级的上下文，而任务为每个线程使用单独的堆栈。</p> <p>与 Hwi 类似，Swi 的运行时间应该要短，并且不能调用任何阻塞 API。这允许高优先级任务（如无线协议栈）根据需要执行。建议 <code>_post()</code> 一些 TI-RTOS <u>同步原语</u>（synchronization primitive），以允许在任务上下文中进行进一步的后处理。请参阅图 41 来说明此类用例。</p> <center id="figure-41"><img src="https://dev.ti.com/tirex/explore/content/simplelink_cc2640r2_sdk_5_30_00_03/docs/ble5stack/ble_user_guide/html/_images/fig-preemption-scenario.jpg" alt="Preemption Scenario" class="medium-zoom-image"><br>图 41. 抢占场景</center> <h2 id="任务"><a href="#任务" class="header-anchor">#</a> 任务</h2> <p>任务线程的优先级高于后台（空闲）线程，但低于软件中断。任务与软件中断的不同之处在于它们可以在执行期间等待（阻塞）直到需要的资源是可用状态。任务需要每个线程都有一个单独的堆栈。TI-RTOS 提供了许多可用于任务间通信和同步的机制。这些包括<u>信号量</u>（Semaphores）、<u>事件</u>（Event）、<u>消息队列</u>（Message queues）和<u>邮箱</u>（Mailboxes）。</p> <h2 id="空闲任务-idle-task"><a href="#空闲任务-idle-task" class="header-anchor">#</a> 空闲任务（Idle Task）</h2> <p>空闲线程在 TI-RTOS 应用程序中以最低优先级执行，并在连续循环（空闲循环）中一个接一个地执行。main 返回后，TI-RTOS 应用程序调用每个 TI-RTOS 模块的启动例程，然后进入空闲循环。每个空闲线程必须等待所有其他线程完成执行才能再次调用。空闲循环会连续运行，除非它被更高优先级的线程抢占（其它线程运行时）。只有没有严格期限要求的函数才应该在空闲循环中执行。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/embedded-system/ble5-stack/ti-rtos/kernel_configuration.html">
        内核配置
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 Blue Monster
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="/assets/music/Anson Seabra - Last Time.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:30px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="/assets/img/cover/last-time.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(/assets/img/cover/last-time.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>Last Time</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>Anson Seabra</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><!----><div id="vuepress-party-cursor" data-v-16fbd2e9></div></div></div>
    <script src="/assets/js/app.7099126a.js" defer></script><script src="/assets/js/2.0bcf0fe5.js" defer></script><script src="/assets/js/12.6771515a.js" defer></script><script src="/assets/js/3.94c01751.js" defer></script>
  </body>
</html>
