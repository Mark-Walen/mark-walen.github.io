import{_ as e,X as i,Y as a,a2 as r}from"./framework-a8949fcd.js";const n="/assets/ll_periodic_advertising_events-572b9d80.png",_="/assets/ll_pawr_ese-7959dd94.png",l="/assets/ll_pawr_se_wrs-9e74afe7.png",A={},t=r('<h2 id="padvb——低功耗周期性广播" tabindex="-1"><a class="header-anchor" href="#padvb——低功耗周期性广播" aria-hidden="true">#</a> PADVB——低功耗周期性广播</h2><h3 id="基础" tabindex="-1"><a class="header-anchor" href="#基础" aria-hidden="true">#</a> 基础</h3><p>ADV 广播逻辑传输（参见<a href="./advb">第三节 ADVB - 低功耗广播</a>）发送的广播包传输在时序上包含一定程度的随机性。在广播事件的调度中，故意插入了 0 到 10 毫秒之间的随机延迟，以避免持续的数据包冲突。在执行传统广播时，这是广播工作的唯一方式。</p><p>周期性广播涉及按确定性调度传输数据包，并提供一种机制，允许其他设备根据广播设备的调度调整它们的扫描活动，以与广播设备设定的时间保持一致。这种同步确保了参与设备之间的有效通信和互动。<strong>周期性广播始终是不可扫描和不可连接的</strong>。周期性广播可以通过为观察设备提供更省电的扫描方式来提高效率，是 LE 音频广播解决方案中的关键组成部分。</p><p>广播以固定的间隔进行，称为周期性广播间隔，广播数据负载可能会发生变化。一系列 AUX_SYNC_IND 和相关的 AUX_CHAIN_IND PDU 形成了一个周期性广播传输。</p><p>在每个周期性广播事件中，先传输一个 AUX_SYNC_IND PDU，然后根据主机提供的负载是否需要分片，传输零个或多个 AUX_CHAIN_IND PDU。</p><p>AUX_ADV_IND PDU 包括一个称为 SyncInfo 的字段，它是通用扩展广播有效负载格式的一部分，包含信道和时序偏移信息。</p><h3 id="信道使用" tabindex="-1"><a class="header-anchor" href="#信道使用" aria-hidden="true">#</a> 信道使用</h3><p>周期性广播使用 37 个通用广播信道。在每个周期性广播事件的开始，使用信道选择算法#2选择一个信道，该算法的输入是事件计数器 paEventCounter 字段。计数器在每个周期性广播事件中递增。与 AUX_SYNC_IND PDU 相关的任何辅助 AUX_CHAIN_IND PDU 都使用特定于实现的算法进行信道选择，并在 AuxPtr 字段中指定。请参见图 1。</p><h3 id="调度" tabindex="-1"><a class="header-anchor" href="#调度" aria-hidden="true">#</a> 调度</h3><p>周期性广播间隔确定广播集的周期性广播的发生频率。它始于 AUX_SYNC_IND PDU 的传输，并随后传输零个或多个 AUX_CHAIN_IND PDU，如图 1 所示。</p><figure><img src="'+n+'" alt="Periodic advertising events" tabindex="0" loading="lazy"><figcaption>图 1. 周期性广播事件</figcaption></figure><p>请注意，图 1 已经简化，可能有多个在不同主广播信道上的 ADV_EXT_IND PDU 被表示为一个单一的框。</p><h3 id="同步建立" tabindex="-1"><a class="header-anchor" href="#同步建立" aria-hidden="true">#</a> 同步建立</h3><p>扫描设备可以通过两种方式之一与周期性广播传输进行同步。它可以扫描 AUX_ADV_IND PDU，并使用 SyncInfo 字段的内容来确定要使用的周期性广播间隔、时序偏移和信道信息，或者它可以通过 LE-ACL 连接从另一台设备接收此信息，该设备本身已经从 AUX_ADV_IND PDU 中确定了此信息。这种方法被称为周期性广播同步传输过程。</p><h2 id="pawr-——-具有响应的-le-周期性广播" tabindex="-1"><a class="header-anchor" href="#pawr-——-具有响应的-le-周期性广播" aria-hidden="true">#</a> PAwR —— 具有响应的 LE 周期性广播</h2><h3 id="基础-1" tabindex="-1"><a class="header-anchor" href="#基础-1" aria-hidden="true">#</a> 基础</h3><p>PAwR 与 PADVB 相似之处：</p><ul><li>PADVB 允许应用数据由一个设备（广播者）传输到一个或多个接收设备（观察者），形成一对多的通信拓扑结构。PAwR 也是如此；</li><li>PAwR 和 PADVB 都使用物理机的通信方式；</li><li>广播数据包的传输在两种情况下均是周期性的，具有固定的间隔，并且在调度中没有随机扰动。</li><li>观察者可以通过AUX_ADV_IND PDU或使用周期广播同步传输（PAST）程序来建立由广播者使用的周期传输计划；</li></ul><p>PAwR 与 PADVB 不同之处：</p><ul><li>数据通信机制 <ul><li>PADVB支持从广播者到观察者的单向数据通信；</li><li>PAwR观察者可以向广播器发送响应数据包。PAwR提供双向、无连接的通信机制。</li></ul></li><li>同步信息 <ul><li>PADVB 的同步信息包含在 AUX_ADV_IND PDU 的 SyncInfo 字段中；</li><li>PAwR 的同步信息包含在 AUX_ADV_IND PDU 的 SyncInfo 字段和 ACAD 字段中。</li></ul></li><li>数据传输 <ul><li>PADVB 广播者在广播事件内安排传输；</li><li>PAwR 广播者在一系列事件和子事件中安排传输，观察者预期以同步的方式进行，以便仅在特定子事件或子事件期间进行监听。</li></ul></li><li>发送连接请求，建立 LE-ACL 连接 <ul><li>PADVB 不具备这个能力；</li><li>PAwR 广播器可以使用传输时隙发送连接请求（AUX_CONNECT_REQ PDU）到特定设备，并与其建立 LE-ACL 连接。</li></ul></li><li>数据更改 <ul><li>在 PADVB 中，应用数据往往只在一段时间内更改；</li><li>PAwR 设计时预期应用数据会频繁更改。</li></ul></li><li>应用数据传递 <ul><li>使用 PADVB，相同的应用数据传递给所有与同一广播集同步的观察者设备；</li><li>使用 PAwR，可以将不同的数据传递给每个观察者设备或一组观察者设备。</li></ul></li></ul><p>支持 PAST 过程对 PADVB 来说是可选的，对 PAwR 是必须的。</p><h3 id="信道的使用" tabindex="-1"><a class="header-anchor" href="#信道的使用" aria-hidden="true">#</a> 信道的使用</h3><p>信道选择是通过使用信道选择算法 #2 完成的，并且在每个周期广播子事件中进行（参见 <a href="#%E8%B0%83%E5%BA%A6-1">2.3 调度</a>）。在子事件中传输的 PDU 的响应使用相同的信道。这包括对AUX_SYNC_SUBEVENT_IND PDU 的响应中发送的 AUX_SYNC_SUBEVENT_RSP PDU 以及对 AUX_CONNECT_REQ PDU 的响应中发送的 AUX_CONNECT_RSP PDU。</p><h3 id="调度-1" tabindex="-1"><a class="header-anchor" href="#调度-1" aria-hidden="true">#</a> 调度</h3><p>与其他广播模式一样，PAwR 的活动发生在“PAwR 事件”中。这些事件以固定的间隔发生，调度中没有随机扰动。每个周期广播间隔 ms 开始一个事件。</p><p>每个 PAwR 事件包含多个子事件，在子事件期间传输广播数据包。主机可以配置每个事件的子事件数量，最多 128 个。每个周期广播子事件间隔 ms 开始一个子事件。主机（HOST）使用 HCI 命令 <code>HCI_LE_Set_Periodic_Advertising_Parameters</code> V2（或更高版本），配置每个事件的子事件数量和周期广播子事件间隔。</p><figure><img src="'+_+'" alt="PAwR events and subevents" tabindex="0" loading="lazy"><figcaption>图 2. PAwR 事件与子事件</figcaption></figure><p>在每个子事件中，广播者传输一个数据包，通常包含一个 AUX_SYNC_SUBEVENT_IND PDU，但也可能包含一个 AUX_CONNECT_REQ PDU。在延迟（称为周期广播响应时隙延迟）之后，在同一子事件中保留了一系列时间间隙，用于接收观察者设备的响应。对AUX_SYNC_SUBEVENT_IND PDU 的响应发送在 AUX_SYNC_SUBEVENT_RSP PDU 中。主机通过 HCI 命令 <code>HCI_LE_Set_Periodic_Advertising_Parameters</code> 配置所需的响应时隙数量。图 3 说明了 PAwR 子事件的结构。</p><figure><img src="'+l+'" alt="A PAwR subevent with response slots" tabindex="0" loading="lazy"><figcaption>图 3. PAwR 有响应时间间隙的子事件</figcaption></figure><h3 id="同步建立-1" tabindex="-1"><a class="header-anchor" href="#同步建立-1" aria-hidden="true">#</a> 同步建立</h3><p><strong>通用</strong></p><p>同步的过程为观察者设备提供了它需要的信息，以便有效地扫描并接收由广播设备传输的相关数据包。在 PAwR 的情况下，这涉及到三个方面：</p><ul><li><strong>观察者需要知道 PAwR 事件的发生频率，以及下一个事件何时发生</strong>。这些信息包含在一个周期广播间隔参数和 syncPacketWindowOffset 的计算值中；</li><li>观察者需要关于子事件的信息，包括它们的发生频率以及每个周期广播带响应事件容纳多少个子事件。它还需要了解与每个子事件中用于响应传输的时间时隙有关的某些详细信息。这些信息包含在 Subevent_Interval、Num_Subevents、Response_Slot_Delay、Response_Slot_Spacing 和 Num_Response_Slots 参数中。</li><li>最后，观察者需要知道它应该扫描哪个子事件号，应该使用哪个特定的响应时隙，并在传输的响应数据包中使用哪个接入地址。</li></ul><p>(1) 和 (2) 中描述的事件时间信息和子事件信息已被观察者获取，从而得到了 PAwR 广播传输的事件和子事件的完整时序参数和结构描述。<strong>但只有当具备 (3) 中的信息时，它才能调度其扫描，以仅接收那些预计包含相关数据的数据包，并安排响应数据包的传输。</strong></p><p>(1) 和 (2) 由 PAwR 逻辑传输处理，如蓝牙核心规范中所定义。有两种可选择的程序可用于获取这一级别的同步信息。这两种程序在本文中涵盖在“扫描周期广播同步信息”和“周期广播同步传输（PAST）”章节中。</p><p><strong>(3) 必须由应用层处理</strong>，并可以在适用的蓝牙配置文件规范中定义，例如电子货架标签（ESL）配置文件。</p><p><strong>扫描周期广播同步信息</strong></p><p>PAwR 和 PADVB 各自使用类似的过程通过扫描获取周期广播同步信息。</p><p>在 PAwR 和 PADVB 中，观察者扫描在次级广播信道上传输的AUX_ADV_IND数据包。AUX_ADV_IND 包括 SyncInfo 字段，其中包含周期广播间隔值以及用于计算称为syncPacketWindowOffset 的变量的一些数据项。获取了这两个值后，观察者可以计算带响应的周期广播事件将何时发生，参见（1）中的概述。</p><p><strong>PAwR 还需要有关子事件和响应时隙的信息</strong>，参见（2）中的概述，才能完成同步过程。这些信息可以在从中获取周期广播间隔的 AUX_ADV_IND PDU 中找到，但在“周期广播响应定时信息”的广播数据类型（AD 类型）中，该类型本身位于 PDU 的附加控制器广播信息（ACAD）字段中。</p><p><strong>周期广播同步传输（PAST）</strong></p><p>在使用 PAST 过程时，有时设备在连接上传递同步参数之前会首先代表另一设备进行扫描以获取同步信息。然而，在 PAwR 的情况下，对于 PAST 的支持是强制性的，因此 PAwR 广播器可以通过 LE ACL 连接向观察者传递所需的同步数据。如果采用这种方法，任何设备都不需要进行 AUX_ADV_IND PDU 的扫描。</p><p><strong>子事件同步和响应时间时隙分配</strong></p><p>子事件同步涉及指示观察者设备应该执行扫描的子事件。一个或多个观察者设备可以同步到同一个子事件。一个观察者可能会同步，以在一个或多个子事件期间接收。</p><p>此外，为了使观察者能够发送响应 PDU，它必须有某种依据来确定使用哪个子事件响应时隙。</p><p>这两个方面的责任都属于应用层。</p>',47),s=[t];function p(P,d){return i(),a("div",null,s)}const D=e(A,[["render",p],["__file","periodic_adv.html.vue"]]);export{D as default};
